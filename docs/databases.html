<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>Database Connections &mdash; Toto 0.12.8 documentation</title>
    
    <link rel="stylesheet" href="_static/haiku.css" type="text/css" />
    <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    './',
        VERSION:     '0.12.8',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="_static/jquery.js"></script>
    <script type="text/javascript" src="_static/underscore.js"></script>
    <script type="text/javascript" src="_static/doctools.js"></script>
    <link rel="top" title="Toto 0.12.8 documentation" href="index.html" />
    <link rel="up" title="The Toto web server" href="web.html" />
    <link rel="next" title="Exceptions" href="exceptions.html" />
    <link rel="prev" title="Method Decorators" href="invocation.html" /> 
  </head>
  <body>
      <div class="header"><h1 class="heading"><a href="index.html">
          <span>Toto 0.12.8 documentation</span></a></h1>
        <h2 class="heading"><span>Database Connections</span></h2>
      </div>
      <div class="topnav">
      
        <p>
        «&#160;&#160;<a href="invocation.html">Method Decorators</a>
        &#160;&#160;::&#160;&#160;
        <a class="uplink" href="index.html">Contents</a>
        &#160;&#160;::&#160;&#160;
        <a href="exceptions.html">Exceptions</a>&#160;&#160;»
        </p>

      </div>
      <div class="content">
        
        
  <div class="section" id="module-toto.dbconnection">
<span id="database-connections"></span><h1>Database Connections<a class="headerlink" href="#module-toto.dbconnection" title="Permalink to this headline">¶</a></h1>
<dl class="class">
<dt id="toto.dbconnection.DBConnection">
<em class="property">class </em><tt class="descclassname">toto.dbconnection.</tt><tt class="descname">DBConnection</tt><a class="reference internal" href="_modules/toto/dbconnection.html#DBConnection"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#toto.dbconnection.DBConnection" title="Permalink to this definition">¶</a></dt>
<dd><p>Toto uses subclasses of DBConnection to support session and account storage as well as general
access to the backing database. Usually, direct access to the underlying database driver will
be available via the <tt class="docutils literal"><span class="pre">DBConnection.db</span></tt> property.</p>
<p>Currently, toto provides the following <tt class="docutils literal"><span class="pre">DBConnection</span></tt> drivers:</p>
<ul class="simple">
<li><tt class="docutils literal"><span class="pre">toto.mongodbconnection.MongoDBConnection</span></tt></li>
<li><tt class="docutils literal"><span class="pre">toto.mysqldbconnection.MySQLdbConnection</span></tt></li>
<li><tt class="docutils literal"><span class="pre">toto.postgresconnection.PostgresConnection</span></tt></li>
<li><tt class="docutils literal"><span class="pre">toto.redisconnection.RedisConnection</span></tt></li>
</ul>
</dd></dl>

<div class="section" id="accounts-and-sessions">
<h2>Accounts and Sessions<a class="headerlink" href="#accounts-and-sessions" title="Permalink to this headline">¶</a></h2>
<dl class="method">
<dt id="toto.dbconnection.DBConnection.create_account">
<tt class="descclassname">DBConnection.</tt><tt class="descname">create_account</tt><big>(</big><em>user_id</em>, <em>password</em>, <em>additional_values={}</em>, <em>**values</em><big>)</big><a class="reference internal" href="_modules/toto/dbconnection.html#DBConnection.create_account"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#toto.dbconnection.DBConnection.create_account" title="Permalink to this definition">¶</a></dt>
<dd><p>Create an account for the given <tt class="docutils literal"><span class="pre">user_id</span></tt> and <tt class="docutils literal"><span class="pre">password</span></tt>. Optionally set additional account
values by passing them as keyword arguments (the <tt class="docutils literal"><span class="pre">additional_values</span></tt> parameter is deprecated).</p>
<p>Note: if your database uses a predefined schema, make sure to create the appropriate columns
before passing additional arguments to <tt class="docutils literal"><span class="pre">create_account</span></tt>.</p>
</dd></dl>

<dl class="method">
<dt id="toto.dbconnection.DBConnection.create_session">
<tt class="descclassname">DBConnection.</tt><tt class="descname">create_session</tt><big>(</big><em>user_id=None</em>, <em>password=None</em>, <em>verify_password=True</em><big>)</big><a class="reference internal" href="_modules/toto/dbconnection.html#DBConnection.create_session"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#toto.dbconnection.DBConnection.create_session" title="Permalink to this definition">¶</a></dt>
<dd><p>Create a new session for the account with the given <tt class="docutils literal"><span class="pre">user_id</span></tt> and <tt class="docutils literal"><span class="pre">password</span></tt>, or an anonymous
session if anonymous sessions are enabled. This method returns a subclass of <tt class="docutils literal"><span class="pre">TotoSession</span></tt>
designed for the current backing database. Pass <tt class="docutils literal"><span class="pre">verify_password=False</span></tt> to create a session
without checking the password. This feature can be used to implement alternative authentication
methods like Facebook, Twitter or Google+.</p>
</dd></dl>

<dl class="method">
<dt id="toto.dbconnection.DBConnection.retrieve_session">
<tt class="descclassname">DBConnection.</tt><tt class="descname">retrieve_session</tt><big>(</big><em>session_id</em>, <em>hmac_data=None</em>, <em>data=None</em><big>)</big><a class="reference internal" href="_modules/toto/dbconnection.html#DBConnection.retrieve_session"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#toto.dbconnection.DBConnection.retrieve_session" title="Permalink to this definition">¶</a></dt>
<dd><p>Retrieve an existing session with the given <tt class="docutils literal"><span class="pre">session_id</span></tt>. Pass the request body and the value
of the <tt class="docutils literal"><span class="pre">x-toto-hmac</span></tt> header as <tt class="docutils literal"><span class="pre">data</span></tt> and <tt class="docutils literal"><span class="pre">hmac_data</span></tt> respectively to verify an authenticated request.
If <tt class="docutils literal"><span class="pre">hmac_data</span></tt> and <tt class="docutils literal"><span class="pre">data</span></tt> are both <tt class="docutils literal"><span class="pre">None</span></tt>, HMAC verification will be skipped. This method returns a
subclasses of <tt class="docutils literal"><span class="pre">TotoSession</span></tt> designed for the current backing database.</p>
<p>Toto uses HMAC verification to ensure that requests and responses are not corrupted in transmission.
The session&#8217;s <tt class="docutils literal"><span class="pre">user_id</span></tt> is used as the key which makes it easy for an attacker to forge a request
so long as they have an active session ID and the associated user ID - both of which are contained
in the response body of each authenticated request. A future update may contain an option to use
a secret key for HMAC verification instead.</p>
<p>The use of HTTPS is strongly recommended for any communication involving sensitive information.</p>
</dd></dl>

<dl class="method">
<dt id="toto.dbconnection.DBConnection.remove_session">
<tt class="descclassname">DBConnection.</tt><tt class="descname">remove_session</tt><big>(</big><em>session_id</em><big>)</big><a class="reference internal" href="_modules/toto/dbconnection.html#DBConnection.remove_session"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#toto.dbconnection.DBConnection.remove_session" title="Permalink to this definition">¶</a></dt>
<dd><p>Invalidate the session with the given <tt class="docutils literal"><span class="pre">session_id</span></tt>.</p>
</dd></dl>

<dl class="method">
<dt id="toto.dbconnection.DBConnection.clear_sessions">
<tt class="descclassname">DBConnection.</tt><tt class="descname">clear_sessions</tt><big>(</big><em>user_id</em><big>)</big><a class="reference internal" href="_modules/toto/dbconnection.html#DBConnection.clear_sessions"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#toto.dbconnection.DBConnection.clear_sessions" title="Permalink to this definition">¶</a></dt>
<dd><p>If implemented, invalidates all sessions tied to the account with the given <tt class="docutils literal"><span class="pre">user_id</span></tt>.</p>
</dd></dl>

<dl class="method">
<dt id="toto.dbconnection.DBConnection.change_password">
<tt class="descclassname">DBConnection.</tt><tt class="descname">change_password</tt><big>(</big><em>user_id</em>, <em>password</em>, <em>new_password</em><big>)</big><a class="reference internal" href="_modules/toto/dbconnection.html#DBConnection.change_password"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#toto.dbconnection.DBConnection.change_password" title="Permalink to this definition">¶</a></dt>
<dd><p>Updates the password for the account with the given <tt class="docutils literal"><span class="pre">user_id</span></tt> and <tt class="docutils literal"><span class="pre">password</span></tt> to match
<tt class="docutils literal"><span class="pre">new_password</span></tt> for all future requests.</p>
</dd></dl>

<dl class="method">
<dt id="toto.dbconnection.DBConnection.generate_password">
<tt class="descclassname">DBConnection.</tt><tt class="descname">generate_password</tt><big>(</big><em>user_id</em><big>)</big><a class="reference internal" href="_modules/toto/dbconnection.html#DBConnection.generate_password"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#toto.dbconnection.DBConnection.generate_password" title="Permalink to this definition">¶</a></dt>
<dd><p>Generates a new password for the account with the given <tt class="docutils literal"><span class="pre">user_id</span></tt> and makes it active
for all future requests. The new password will be returned. This method is designed to
support &#8220;forgot password&#8221; functionality.</p>
</dd></dl>

<dl class="method">
<dt id="toto.dbconnection.DBConnection.set_session_cache">
<tt class="descclassname">DBConnection.</tt><tt class="descname">set_session_cache</tt><big>(</big><em>session_cache</em><big>)</big><a class="reference internal" href="_modules/toto/dbconnection.html#DBConnection.set_session_cache"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#toto.dbconnection.DBConnection.set_session_cache" title="Permalink to this definition">¶</a></dt>
<dd><p>Optionally set an instance of <tt class="docutils literal"><span class="pre">TotoSessionCache</span></tt> that will be used to store sessions separately from
this database.</p>
</dd></dl>

<dl class="method">
<dt id="toto.dbconnection.DBConnection._load_session_data">
<tt class="descclassname">DBConnection.</tt><tt class="descname">_load_session_data</tt><big>(</big><em>session_id</em><big>)</big><a class="reference internal" href="_modules/toto/dbconnection.html#DBConnection._load_session_data"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#toto.dbconnection.DBConnection._load_session_data" title="Permalink to this definition">¶</a></dt>
<dd><p>Called by <tt class="docutils literal"><span class="pre">DBConnection.retrieve_session</span></tt>. Will attempt to load data from an associated <tt class="docutils literal"><span class="pre">TotoSessionCache</span></tt>.
If no <tt class="docutils literal"><span class="pre">TotoSessionCache</span></tt> is associated with the current instance, the result of <tt class="docutils literal"><span class="pre">self._load_uncached_data(session_id)</span></tt>
is returned.</p>
</dd></dl>

<dl class="method">
<dt id="toto.dbconnection.DBConnection._load_uncached_data">
<tt class="descclassname">DBConnection.</tt><tt class="descname">_load_uncached_data</tt><big>(</big><em>session_id</em><big>)</big><a class="reference internal" href="_modules/toto/dbconnection.html#DBConnection._load_uncached_data"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#toto.dbconnection.DBConnection._load_uncached_data" title="Permalink to this definition">¶</a></dt>
<dd><p>Load a session data <tt class="docutils literal"><span class="pre">dict</span></tt> from the local database. Called by default and if no <tt class="docutils literal"><span class="pre">TotoSessionCache</span></tt> has been
associated with the current instance of <tt class="docutils literal"><span class="pre">DBConnection</span></tt>.</p>
</dd></dl>

<dl class="method">
<dt id="toto.dbconnection.DBConnection._cache_session_data">
<tt class="descclassname">DBConnection.</tt><tt class="descname">_cache_session_data</tt><big>(</big><em>session_data</em><big>)</big><a class="reference internal" href="_modules/toto/dbconnection.html#DBConnection._cache_session_data"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#toto.dbconnection.DBConnection._cache_session_data" title="Permalink to this definition">¶</a></dt>
<dd><p>Called by <tt class="docutils literal"><span class="pre">DBConnection.create_session</span></tt> and by <tt class="docutils literal"><span class="pre">DBConnection.retrieve_session</span></tt> if there is a change in <tt class="docutils literal"><span class="pre">TotoSession.expires</span></tt>.
Returns <tt class="docutils literal"><span class="pre">True</span></tt> if the session has been written to an associated <tt class="docutils literal"><span class="pre">TotoSessionCache</span></tt>, <tt class="docutils literal"><span class="pre">False</span></tt> otherwise.</p>
</dd></dl>

</div>
</div>


      </div>
      <div class="bottomnav">
      
        <p>
        «&#160;&#160;<a href="invocation.html">Method Decorators</a>
        &#160;&#160;::&#160;&#160;
        <a class="uplink" href="index.html">Contents</a>
        &#160;&#160;::&#160;&#160;
        <a href="exceptions.html">Exceptions</a>&#160;&#160;»
        </p>

      </div>

    <div class="footer">
        &copy; Copyright 2014, Jeremy Olmsted-Thompson.
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 1.2.1.
    </div>
  </body>
</html>