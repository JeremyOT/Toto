<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>Servers, Handlers and Sessions &mdash; Toto 1.0.10 documentation</title>
    
    <link rel="stylesheet" href="_static/haiku.css" type="text/css" />
    <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    './',
        VERSION:     '1.0.10',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="_static/jquery.js"></script>
    <script type="text/javascript" src="_static/underscore.js"></script>
    <script type="text/javascript" src="_static/doctools.js"></script>
    <link rel="top" title="Toto 1.0.10 documentation" href="index.html" />
    <link rel="up" title="The Toto web server" href="web.html" />
    <link rel="next" title="Method Decorators" href="invocation.html" />
    <link rel="prev" title="The Toto web server" href="web.html" /> 
  </head>
  <body>
      <div class="header"><h1 class="heading"><a href="index.html">
          <span>Toto 1.0.10 documentation</span></a></h1>
        <h2 class="heading"><span>Servers, Handlers and Sessions</span></h2>
      </div>
      <div class="topnav">
      
        <p>
        «&#160;&#160;<a href="web.html">The Toto web server</a>
        &#160;&#160;::&#160;&#160;
        <a class="uplink" href="index.html">Contents</a>
        &#160;&#160;::&#160;&#160;
        <a href="invocation.html">Method Decorators</a>&#160;&#160;»
        </p>

      </div>
      <div class="content">
        
        
  <div class="section" id="module-toto.server">
<span id="servers-handlers-and-sessions"></span><h1>Servers, Handlers and Sessions<a class="headerlink" href="#module-toto.server" title="Permalink to this headline">¶</a></h1>
<p>The Toto server and handler classes are designed to simplify most of the boilerplate that comes with
building web services so you can focus on the important parts specific to your application.</p>
<p>Most of the time you&#8217;ll only need this script to start your server:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="kn">from</span> <span class="nn">toto.server</span> <span class="kn">import</span> <span class="n">TotoServer</span>

<span class="n">TotoServer</span><span class="p">(</span><span class="s">&#39;settings.conf&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">run</span><span class="p">()</span>
</pre></div>
</div>
<p>Methods, startup functions and databases can all be configured with the conf file.</p>
<p>Run your startup script with &#8211;help to see all available options.</p>
<div class="section" id="server">
<h2>Server<a class="headerlink" href="#server" title="Permalink to this headline">¶</a></h2>
<dl class="class">
<dt id="toto.server.TotoServer">
<em class="property">class </em><tt class="descclassname">toto.server.</tt><tt class="descname">TotoServer</tt><big>(</big><em>conf_file=None</em>, <em>**kwargs</em><big>)</big><a class="reference internal" href="_modules/toto/server.html#TotoServer"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#toto.server.TotoServer" title="Permalink to this definition">¶</a></dt>
<dd><p>Instances can be configured in three ways:</p>
<ol class="arabic simple">
<li>(Most common) Pass the path to a config file as the first parameter to the constructor.</li>
<li>Pass config parameters as command line arguments to the initialization script.</li>
<li>Pass keyword arguments to the constructor.</li>
</ol>
<p>Precidence is as follows:</p>
<p>Keyword args, config file, command line</p>
</dd></dl>

<p>The following method will normally be your only interaction with an instance of <tt class="docutils literal"><span class="pre">TotoServer</span></tt></p>
<dl class="method">
<dt id="toto.server.TotoServer.run">
<tt class="descclassname">TotoServer.</tt><tt class="descname">run</tt><big>(</big><big>)</big><a class="headerlink" href="#toto.server.TotoServer.run" title="Permalink to this definition">¶</a></dt>
<dd><p>Start the service. Depending on the initialization options, this may run more than one
service process.</p>
</dd></dl>

</div>
<div class="section" id="handler">
<h2>Handler<a class="headerlink" href="#handler" title="Permalink to this headline">¶</a></h2>
<dl class="class">
<dt id="toto.handler.TotoHandler">
<em class="property">class </em><tt class="descclassname">toto.handler.</tt><tt class="descname">TotoHandler</tt><big>(</big><em>application</em>, <em>request</em>, <em>**kwargs</em><big>)</big><a class="reference internal" href="_modules/toto/handler.html#TotoHandler"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#toto.handler.TotoHandler" title="Permalink to this definition">¶</a></dt>
<dd><p>The handler is responsible for processing all requests to the server. An instance
will be initialized for each incoming request and will handle authentication, session
management and method delegation for you.</p>
<p>You can set the module to use for method delegation via the <tt class="docutils literal"><span class="pre">method_module</span></tt> parameter.
Methods are modules that contain an invoke function:</p>
<div class="highlight-python"><div class="highlight"><pre>def invoke(handler, parameters)
</pre></div>
</div>
<p>The request handler will be passed as the first parameter to the invoke function and
provides access to the server&#8217;s database connection, the current session and other
useful request properties. Request parameters will be passed as the second argument
to the invoke function. Any return values from <tt class="docutils literal"><span class="pre">invoke()</span></tt> functions should be
JSON serializable.</p>
<p>Toto methods are generally invoked via a POST request to the server with a JSON
serialized object as the body. The body should contain two properties:</p>
<ol class="arabic simple">
<li>method - The name of the method to invoke.</li>
<li>parameters - Any parameters to pass to the Toto function.</li>
</ol>
<p>For example:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="p">{</span><span class="s">&quot;method&quot;</span><span class="p">:</span> <span class="s">&quot;account.create&quot;</span><span class="p">,</span> <span class="s">&quot;parameters&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s">&quot;user_id&quot;</span><span class="p">:</span> <span class="s">&quot;test&quot;</span><span class="p">,</span> <span class="s">&quot;password&quot;</span><span class="p">:</span> <span class="s">&quot;testpassword&quot;</span><span class="p">}}</span>
</pre></div>
</div>
<p>Will call method_module.account.create.invoke(handler, {&#8216;user_id&#8217;: &#8216;test&#8217;, &#8216;password&#8217;: &#8216;testpassword&#8217;})</p>
<p>An <tt class="docutils literal"><span class="pre">invoke()</span></tt> function can be decorated with <tt class="docutils literal"><span class="pre">&#64;tornado.gen.coroutine</span></tt> and be run as a Tornado coroutine.</p>
<p>Alternatively, an <tt class="docutils literal"><span class="pre">invoke(handler,</span> <span class="pre">parameters)</span></tt> function may be decorated with <tt class="docutils literal"><span class="pre">&#64;toto.invocation.asynchronous</span></tt>.
If a function decorated in this manner does not return a value, the connection well remain open until
<tt class="docutils literal"><span class="pre">handler.respond(result,</span> <span class="pre">error)</span></tt> is called where <tt class="docutils literal"><span class="pre">error</span></tt> is an <tt class="docutils literal"><span class="pre">Exception</span></tt> or <tt class="docutils literal"><span class="pre">None</span></tt> and <tt class="docutils literal"><span class="pre">result</span></tt>
is a normal <tt class="docutils literal"><span class="pre">invoke()</span></tt> return value or <tt class="docutils literal"><span class="pre">None</span></tt>.</p>
<p>There are client libraries for iOS and Javascript that will make using Toto much easier. They are
available at <a class="reference external" href="https://github.com/JeremyOT/TotoClient-iOS">https://github.com/JeremyOT/TotoClient-iOS</a> and <a class="reference external" href="https://github.com/JeremyOT/TotoClient-JS">https://github.com/JeremyOT/TotoClient-JS</a>
respectively.</p>
</dd></dl>

<div class="section" id="response-paths">
<h3>Response paths<a class="headerlink" href="#response-paths" title="Permalink to this headline">¶</a></h3>
<dl class="method">
<dt id="toto.handler.TotoHandler.respond">
<tt class="descclassname">TotoHandler.</tt><tt class="descname">respond</tt><big>(</big><em>result=None</em>, <em>error=None</em>, <em>batch_results=None</em>, <em>allow_async=True</em><big>)</big><a class="reference internal" href="_modules/toto/handler.html#TotoHandler.respond"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#toto.handler.TotoHandler.respond" title="Permalink to this definition">¶</a></dt>
<dd><p>Respond to the request with the given result or error object (the <tt class="docutils literal"><span class="pre">batch_results</span></tt> and
<tt class="docutils literal"><span class="pre">allow_async</span></tt> parameters are for internal use only and not intended to be supplied manually).
Responses will be serialized according to the <tt class="docutils literal"><span class="pre">response_type</span></tt> propery. The default
serialization is &#8220;application/json&#8221;. Other supported protocols are:</p>
<ul class="simple">
<li>application/bson - requires pymongo</li>
<li>application/msgpack - requires msgpack-python</li>
</ul>
<p>The response will also contain any available session information.</p>
<p>To help with error handling in asynchronous methods, calling <tt class="docutils literal"><span class="pre">handler.respond(error=&lt;your_error&gt;)</span></tt> with a caught
exception will trigger a normal Toto error response, log the error and finish the request. This is the same basic
flow that is used internally when exceptions are raised from synchronous method calls.</p>
<p>The &#8220;error&#8221; property of the response is derived from the <tt class="docutils literal"><span class="pre">error</span></tt> parameter in the following ways:</p>
<ol class="arabic simple">
<li>If <tt class="docutils literal"><span class="pre">error</span></tt> is an instance of <tt class="docutils literal"><span class="pre">TotoException</span></tt>, &#8220;error&#8221; will be a dictionary with &#8220;value&#8221; and &#8220;code&#8221; keys matching those of the <tt class="docutils literal"><span class="pre">TotoException</span></tt>.</li>
<li>In all other cases, <tt class="docutils literal"><span class="pre">error</span></tt> is first converted to a <tt class="docutils literal"><span class="pre">TotoException</span></tt> with <tt class="docutils literal"><span class="pre">code</span> <span class="pre">=</span> <span class="pre">&lt;ERROR_SERVER&gt;</span></tt> and <tt class="docutils literal"><span class="pre">value</span> <span class="pre">=</span> <span class="pre">str(error)</span></tt> before following (1.).</li>
</ol>
<p>To send custom error information, pass an instance of <tt class="docutils literal"><span class="pre">TotoException</span></tt> with <tt class="docutils literal"><span class="pre">value</span> <span class="pre">=</span> <span class="pre">&lt;some_json_serializable_object&gt;</span></tt>.</p>
</dd></dl>

<dl class="method">
<dt id="toto.handler.TotoHandler.respond_raw">
<tt class="descclassname">TotoHandler.</tt><tt class="descname">respond_raw</tt><big>(</big><em>body</em>, <em>content_type</em>, <em>finish=True</em><big>)</big><a class="reference internal" href="_modules/toto/handler.html#TotoHandler.respond_raw"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#toto.handler.TotoHandler.respond_raw" title="Permalink to this definition">¶</a></dt>
<dd><p>Respond raw is used by respond to send the response to the client. You can pass a string as the body parameter
and it will be written directly to the response stream. The response &#8220;content-type&#8221; header will be set to <tt class="docutils literal"><span class="pre">content_type</span></tt>.
Use finish to specify whether or not the response stream should be closed after body is written. Use <tt class="docutils literal"><span class="pre">finish=False</span></tt>
to send the response in multiple calls to <tt class="docutils literal"><span class="pre">respond_raw</span></tt>.</p>
</dd></dl>

<dl class="method">
<dt id="toto.handler.TotoHandler.on_connection_close">
<tt class="descclassname">TotoHandler.</tt><tt class="descname">on_connection_close</tt><big>(</big><big>)</big><a class="reference internal" href="_modules/toto/handler.html#TotoHandler.on_connection_close"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#toto.handler.TotoHandler.on_connection_close" title="Permalink to this definition">¶</a></dt>
<dd><p>You should not call this method directly, but if you implement an <tt class="docutils literal"><span class="pre">on_connection_close()</span></tt> function in a
method module (where you defined invoke) it will be called when the connection closes if that method was
invoked. E.G.:</p>
<div class="highlight-python"><div class="highlight"><pre>def invoke(handler, parameters):
  #main method body

def on_connection_close(handler):
  #clean up
</pre></div>
</div>
</dd></dl>

<dl class="attribute">
<dt id="toto.server.toto.handler.TotoHandler.headers_only">
<tt class="descclassname">toto.handler.TotoHandler.</tt><tt class="descname">headers_only</tt><a class="headerlink" href="#toto.server.toto.handler.TotoHandler.headers_only" title="Permalink to this definition">¶</a></dt>
<dd><p>Will be set to <tt class="docutils literal"><span class="pre">True</span></tt> if the handler is expected to send only response headers. By default,
this will only be set for &#8220;HEAD&#8221; requests. When <tt class="docutils literal"><span class="pre">True</span></tt>, <tt class="docutils literal"><span class="pre">respond()</span></tt> and <tt class="docutils literal"><span class="pre">respond_raw()</span></tt>
will not write a body. Check this property in method implementations to avoid performing
unnecessary work when a body is not required.</p>
</dd></dl>

</div>
<div class="section" id="event-framework">
<h3>Event Framework<a class="headerlink" href="#event-framework" title="Permalink to this headline">¶</a></h3>
<dl class="method">
<dt id="toto.handler.TotoHandler.register_event_handler">
<tt class="descclassname">TotoHandler.</tt><tt class="descname">register_event_handler</tt><big>(</big><em>event_name</em>, <em>handler</em>, <em>run_on_main_loop=True</em>, <em>deregister_on_finish=False</em><big>)</big><a class="reference internal" href="_modules/toto/handler.html#TotoHandler.register_event_handler"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#toto.handler.TotoHandler.register_event_handler" title="Permalink to this definition">¶</a></dt>
<dd><p>If using Toto&#8217;s event framework, this method makes it easy to register an event callback tied to the
current connection and handler. Event handlers registered via this method will not be called once this handler
has finished (connection closed). The <tt class="docutils literal"><span class="pre">deregister_on_finish</span></tt> parameter will cause this handler to be explicitly
deregisted as part of the <tt class="docutils literal"><span class="pre">handler.on_finish</span></tt> event. Otherwise, event handlers are only cleaned up when the
associated event is received.</p>
<p>The return value can be used to manually deregister the event handler at a later point.</p>
</dd></dl>

<dl class="method">
<dt id="toto.handler.TotoHandler.deregister_event_handler">
<tt class="descclassname">TotoHandler.</tt><tt class="descname">deregister_event_handler</tt><big>(</big><em>sig</em><big>)</big><a class="reference internal" href="_modules/toto/handler.html#TotoHandler.deregister_event_handler"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#toto.handler.TotoHandler.deregister_event_handler" title="Permalink to this definition">¶</a></dt>
<dd><p>Pass the value returned from <tt class="docutils literal"><span class="pre">register_event_handler</span></tt> to deregister an active event handler.</p>
</dd></dl>

</div>
<div class="section" id="batch-requests">
<h3>Batch Requests<a class="headerlink" href="#batch-requests" title="Permalink to this headline">¶</a></h3>
<dl class="class">
<dt id="toto.handler.BatchHandlerProxy">
<em class="property">class </em><tt class="descclassname">toto.handler.</tt><tt class="descname">BatchHandlerProxy</tt><big>(</big><em>handler</em>, <em>request_key</em><big>)</big><a class="reference internal" href="_modules/toto/handler.html#BatchHandlerProxy"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#toto.handler.BatchHandlerProxy" title="Permalink to this definition">¶</a></dt>
<dd><p>A proxy to a handler, this class intercepts calls to <tt class="docutils literal"><span class="pre">handler.respond()</span></tt> in order to match the
response to the proper batch <tt class="docutils literal"><span class="pre">request_key</span></tt>. If a method is invoked as part of a batch request,
an instance of <tt class="docutils literal"><span class="pre">BatchHandlerProxy</span></tt> will be passed instead of a <tt class="docutils literal"><span class="pre">TotoHandler</span></tt>. Though this
replacement should be transparent to the method invocation, you may access the underlying handler
with <tt class="docutils literal"><span class="pre">proxy.handler</span></tt>.</p>
</dd></dl>

<dl class="method">
<dt id="toto.handler.BatchHandlerProxy.respond">
<tt class="descclassname">BatchHandlerProxy.</tt><tt class="descname">respond</tt><big>(</big><em>result=None</em>, <em>error=None</em>, <em>allow_async=True</em><big>)</big><a class="reference internal" href="_modules/toto/handler.html#BatchHandlerProxy.respond"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#toto.handler.BatchHandlerProxy.respond" title="Permalink to this definition">¶</a></dt>
<dd><p>Sets the response for the corresponding batch <tt class="docutils literal"><span class="pre">request_key</span></tt>. When all requests have been processed,
the combined response will passed to the underlying handler&#8217;s <tt class="docutils literal"><span class="pre">respond()</span></tt>.</p>
<p>The <tt class="docutils literal"><span class="pre">allow_async</span></tt> parameter is for internal use only and is not intended to be supplied manually.</p>
</dd></dl>

</div>
<div class="section" id="instrumentation">
<h3>Instrumentation<a class="headerlink" href="#instrumentation" title="Permalink to this headline">¶</a></h3>
<dl class="classmethod">
<dt id="toto.handler.TotoHandler.set_before_handler">
<em class="property">classmethod </em><tt class="descclassname">TotoHandler.</tt><tt class="descname">set_before_handler</tt><big>(</big><em>handler</em><big>)</big><a class="reference internal" href="_modules/toto/handler.html#TotoHandler.set_before_handler"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#toto.handler.TotoHandler.set_before_handler" title="Permalink to this definition">¶</a></dt>
<dd><p>Set the handler that will be called before any method invocation. This is useful for instrumentation. The handler will be
called with <tt class="docutils literal"><span class="pre">handler,</span> <span class="pre">transaction_id,</span> <span class="pre">method</span></tt>, where <tt class="docutils literal"><span class="pre">transaction_id</span></tt> is a UUID and <tt class="docutils literal"><span class="pre">method</span></tt> is the name of the
invoked method. For batch requests each invocation will be tracked and logged separately, but there will also be a message
logged with name <tt class="docutils literal"><span class="pre">&quot;&lt;batch&gt;&quot;</span></tt> which wraps the entire request. The default handler is a no op.</p>
</dd></dl>

<dl class="classmethod">
<dt id="toto.handler.TotoHandler.set_after_handler">
<em class="property">classmethod </em><tt class="descclassname">TotoHandler.</tt><tt class="descname">set_after_handler</tt><big>(</big><em>handler</em><big>)</big><a class="reference internal" href="_modules/toto/handler.html#TotoHandler.set_after_handler"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#toto.handler.TotoHandler.set_after_handler" title="Permalink to this definition">¶</a></dt>
<dd><p>Set the handler that will be called after any method invocation. The handler will be called with <tt class="docutils literal"><span class="pre">handler,</span> <span class="pre">transaction_id</span></tt>,
where <tt class="docutils literal"><span class="pre">transaction_id</span></tt> is the UUID that was passed to the before handler. The default handler is a no op.</p>
</dd></dl>

</div>
</div>
<div class="section" id="sessions">
<h2>Sessions<a class="headerlink" href="#sessions" title="Permalink to this headline">¶</a></h2>
<dl class="method">
<dt id="toto.handler.TotoHandler.create_session">
<tt class="descclassname">TotoHandler.</tt><tt class="descname">create_session</tt><big>(</big><em>user_id=None</em>, <em>password=None</em>, <em>verify_password=True</em><big>)</big><a class="reference internal" href="_modules/toto/handler.html#TotoHandler.create_session"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#toto.handler.TotoHandler.create_session" title="Permalink to this definition">¶</a></dt>
<dd><p>Create a new session for the given user id and password (or an anonymous session if <tt class="docutils literal"><span class="pre">user_id</span></tt> is <tt class="docutils literal"><span class="pre">None</span></tt>).
After this method is called, the session will be available via <tt class="docutils literal"><span class="pre">self.session</span></tt>. As with the
<tt class="docutils literal"><span class="pre">db_connection.create_session()</span></tt> method, you may pass <tt class="docutils literal"><span class="pre">verify_password=False</span></tt> to create a session without
checking the password. This can be used to implement alternative authentication methods like Facebook, Twitter
and Google+.</p>
</dd></dl>

<dl class="method">
<dt id="toto.handler.TotoHandler.retrieve_session">
<tt class="descclassname">TotoHandler.</tt><tt class="descname">retrieve_session</tt><big>(</big><em>session_id=None</em><big>)</big><a class="reference internal" href="_modules/toto/handler.html#TotoHandler.retrieve_session"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#toto.handler.TotoHandler.retrieve_session" title="Permalink to this definition">¶</a></dt>
<dd><p>Retrieve the session specified by the request headers (or if enabled, the request cookie) and store it
in <tt class="docutils literal"><span class="pre">self.session</span></tt>. Alternatively, pass a <tt class="docutils literal"><span class="pre">session_id</span></tt> to this function to retrieve that session explicitly.</p>
<p>If the <tt class="docutils literal"><span class="pre">hmac_enabled</span></tt> option is set to <tt class="docutils literal"><span class="pre">True</span></tt>, Verify the session against the given request. Expects that
the request&#8217;s <tt class="docutils literal"><span class="pre">x-toto-hmac</span></tt> header is the sha1 hmac of the request signature signed with the authenticated key.</p>
<p>The signature takes the form: <tt class="docutils literal"><span class="pre">method</span> <span class="pre">+</span> <span class="pre">uri</span> <span class="pre">+</span> <span class="pre">body</span> <span class="pre">or</span> <span class="pre">''</span></tt></p>
</dd></dl>

<dl class="classmethod">
<dt id="toto.handler.TotoHandler.set_hmac_handler">
<em class="property">classmethod </em><tt class="descclassname">TotoHandler.</tt><tt class="descname">set_hmac_handler</tt><big>(</big><em>handler</em><big>)</big><a class="reference internal" href="_modules/toto/handler.html#TotoHandler.set_hmac_handler"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#toto.handler.TotoHandler.set_hmac_handler" title="Permalink to this definition">¶</a></dt>
<dd><p>Set the hmac verification function. It will be called with <tt class="docutils literal"><span class="pre">handler(session,</span> <span class="pre">request,</span> <span class="pre">headers)</span></tt> and may be used to add
additional verification or to modify the signature used for validation, e.g. to confirm request time.</p>
</dd></dl>

<dl class="classmethod">
<dt id="toto.handler.TotoHandler.set_response_hmac_handler">
<em class="property">classmethod </em><tt class="descclassname">TotoHandler.</tt><tt class="descname">set_response_hmac_handler</tt><big>(</big><em>handler</em><big>)</big><a class="reference internal" href="_modules/toto/handler.html#TotoHandler.set_response_hmac_handler"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#toto.handler.TotoHandler.set_response_hmac_handler" title="Permalink to this definition">¶</a></dt>
<dd><p>Set the hmac generation function for responses. It will be called with <tt class="docutils literal"><span class="pre">handler(session,</span> <span class="pre">response_body)</span></tt> and may be used to add
to modify the signature used for validation. It must return a string.</p>
</dd></dl>

<div class="section" id="the-totosession-class">
<h3>The TotoSession class<a class="headerlink" href="#the-totosession-class" title="Permalink to this headline">¶</a></h3>
<dl class="class">
<dt id="toto.session.TotoSession">
<em class="property">class </em><tt class="descclassname">toto.session.</tt><tt class="descname">TotoSession</tt><big>(</big><em>db</em>, <em>session_data</em>, <em>session_cache=None</em>, <em>key=None</em><big>)</big><a class="reference internal" href="_modules/toto/session.html#TotoSession"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#toto.session.TotoSession" title="Permalink to this definition">¶</a></dt>
<dd><p>Instances of <tt class="docutils literal"><span class="pre">TotoSession</span></tt> provide dictionary-like access to current session variables, and the current
account (if authenticated).</p>
</dd></dl>

<dl class="method">
<dt id="toto.session.TotoSession.refresh">
<tt class="descclassname">TotoSession.</tt><tt class="descname">refresh</tt><big>(</big><big>)</big><a class="reference internal" href="_modules/toto/session.html#TotoSession.refresh"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#toto.session.TotoSession.refresh" title="Permalink to this definition">¶</a></dt>
<dd><p>Refresh the current session to the state in the database.</p>
</dd></dl>

<dl class="method">
<dt id="toto.session.TotoSession.save">
<tt class="descclassname">TotoSession.</tt><tt class="descname">save</tt><big>(</big><big>)</big><a class="reference internal" href="_modules/toto/session.html#TotoSession.save"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#toto.session.TotoSession.save" title="Permalink to this definition">¶</a></dt>
<dd><p>Save the session to the database.</p>
</dd></dl>

<dl class="method">
<dt id="toto.session.TotoSession.get_account">
<tt class="descclassname">TotoSession.</tt><tt class="descname">get_account</tt><big>(</big><em>*args</em><big>)</big><a class="reference internal" href="_modules/toto/session.html#TotoSession.get_account"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#toto.session.TotoSession.get_account" title="Permalink to this definition">¶</a></dt>
<dd><p>Load the account associated with this session (if authenticated). Session properties are
serialized to a binary string and stored as the <tt class="docutils literal"><span class="pre">TotoSession.state</span></tt> property, so you don&#8217;t need to configure your database to handle them in
advance.</p>
</dd></dl>

<dl class="classmethod">
<dt id="toto.session.TotoSession.set_serializer">
<em class="property">classmethod </em><tt class="descclassname">TotoSession.</tt><tt class="descname">set_serializer</tt><big>(</big><em>serializer</em><big>)</big><a class="reference internal" href="_modules/toto/session.html#TotoSession.set_serializer"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#toto.session.TotoSession.set_serializer" title="Permalink to this definition">¶</a></dt>
<dd><p>Set the module that instances of <tt class="docutils literal"><span class="pre">TotoSession</span></tt> and <tt class="docutils literal"><span class="pre">TotoSessionCache</span></tt> will use to serialize session state. The module must implement <tt class="docutils literal"><span class="pre">loads</span></tt> and <tt class="docutils literal"><span class="pre">dumps</span></tt>
and support serialization and deserialization of any data you want to store in the session.
By default, <tt class="docutils literal"><span class="pre">cPickle</span></tt> is used.</p>
</dd></dl>

<dl class="classmethod">
<dt id="toto.session.TotoSession.loads">
<em class="property">classmethod </em><tt class="descclassname">TotoSession.</tt><tt class="descname">loads</tt><big>(</big><em>data</em><big>)</big><a class="reference internal" href="_modules/toto/session.html#TotoSession.loads"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#toto.session.TotoSession.loads" title="Permalink to this definition">¶</a></dt>
<dd><p>A convenience method to call <tt class="docutils literal"><span class="pre">serializer.loads()</span></tt> on the active serializer.</p>
</dd></dl>

<dl class="classmethod">
<dt id="toto.session.TotoSession.dumps">
<em class="property">classmethod </em><tt class="descclassname">TotoSession.</tt><tt class="descname">dumps</tt><big>(</big><em>data</em><big>)</big><a class="reference internal" href="_modules/toto/session.html#TotoSession.dumps"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#toto.session.TotoSession.dumps" title="Permalink to this definition">¶</a></dt>
<dd><p>A convenience method to call <tt class="docutils literal"><span class="pre">serializer.dumps()</span></tt> on the active serializer.</p>
</dd></dl>

<dl class="classmethod">
<dt id="toto.session.TotoSession.generate_id">
<em class="property">classmethod </em><tt class="descclassname">TotoSession.</tt><tt class="descname">generate_id</tt><big>(</big><big>)</big><a class="reference internal" href="_modules/toto/session.html#TotoSession.generate_id"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#toto.session.TotoSession.generate_id" title="Permalink to this definition">¶</a></dt>
<dd><p>Generate a random 22 character url safe session ID string.</p>
</dd></dl>

</div>
<div class="section" id="the-totosessioncache-class">
<h3>The TotoSessionCache class<a class="headerlink" href="#the-totosessioncache-class" title="Permalink to this headline">¶</a></h3>
<dl class="class">
<dt id="toto.session.TotoSessionCache">
<em class="property">class </em><tt class="descclassname">toto.session.</tt><tt class="descname">TotoSessionCache</tt><a class="reference internal" href="_modules/toto/session.html#TotoSessionCache"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#toto.session.TotoSessionCache" title="Permalink to this definition">¶</a></dt>
<dd><p>Instances of <tt class="docutils literal"><span class="pre">TotoSessionCache</span></tt> allow for sessions to be stored separately from the main application database. As sessions must be retrieved
for each authenticated request, it can be useful to keep them in a specialized database (redis, memcached) separate from the rest of your data.</p>
<p>Note: cached sessions cannot currently be removed before their expiry.</p>
</dd></dl>

<dl class="method">
<dt id="toto.session.TotoSessionCache.store_session">
<tt class="descclassname">TotoSessionCache.</tt><tt class="descname">store_session</tt><big>(</big><em>session_data</em><big>)</big><a class="reference internal" href="_modules/toto/session.html#TotoSessionCache.store_session"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#toto.session.TotoSessionCache.store_session" title="Permalink to this definition">¶</a></dt>
<dd><p>Store a <tt class="docutils literal"><span class="pre">TotoSession</span></tt> with the given <tt class="docutils literal"><span class="pre">session_data</span></tt>. <tt class="docutils literal"><span class="pre">session_data</span></tt> can be expected to contain, at a minimum, <tt class="docutils literal"><span class="pre">session_id</span></tt> and <tt class="docutils literal"><span class="pre">expires</span></tt>.
If an existing session matches the <tt class="docutils literal"><span class="pre">session_id</span></tt> contained in <tt class="docutils literal"><span class="pre">session_data</span></tt>, it should be overwritten. The session is expected to be removed
after the time specified by <tt class="docutils literal"><span class="pre">expires</span></tt>. The storage implementation is allowed to change the session&#8217;s <tt class="docutils literal"><span class="pre">session_id</span></tt> if needed by returning the new
id. Returning any falsey value will not affect the <tt class="docutils literal"><span class="pre">session_id</span></tt>.</p>
</dd></dl>

<dl class="method">
<dt id="toto.session.TotoSessionCache.load_session">
<tt class="descclassname">TotoSessionCache.</tt><tt class="descname">load_session</tt><big>(</big><em>session_id</em><big>)</big><a class="reference internal" href="_modules/toto/session.html#TotoSessionCache.load_session"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#toto.session.TotoSessionCache.load_session" title="Permalink to this definition">¶</a></dt>
<dd><p>Retrieve the session with the given <tt class="docutils literal"><span class="pre">session_id</span></tt>. This method should return the <tt class="docutils literal"><span class="pre">session_data</span></tt> <tt class="docutils literal"><span class="pre">dict</span></tt> that was originally passed to
<tt class="docutils literal"><span class="pre">store_session()</span></tt>.</p>
</dd></dl>

<dl class="class">
<dt id="toto.clientsessioncache.ClientCache">
<em class="property">class </em><tt class="descclassname">toto.clientsessioncache.</tt><tt class="descname">ClientCache</tt><big>(</big><em>cipher</em>, <em>hmac_key</em><big>)</big><a class="reference internal" href="_modules/toto/clientsessioncache.html#ClientCache"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#toto.clientsessioncache.ClientCache" title="Permalink to this definition">¶</a></dt>
<dd><p>A <tt class="docutils literal"><span class="pre">TotoSessionCache</span></tt> implementation that stores all session data with the
client. Depending on use, the session may be sent as a header or cookie.
<tt class="docutils literal"><span class="pre">ClientCache</span></tt> works by storing the encrypted session state in
the session ID and decrypting it on each request. When using this method,
it is important to keep session state small as it can add significant
overhead to each request.</p>
<p><tt class="docutils literal"><span class="pre">cipher</span></tt> will be used to encrypt and decrypt the session data. It should
be identical between all servers in a deployment to allow proper request
balancing. <tt class="docutils literal"><span class="pre">cipher</span></tt> is expected to implement <tt class="docutils literal"><span class="pre">encrypt(data)</span></tt> and
the reverse <tt class="docutils literal"><span class="pre">decrypt(data)</span></tt> both accepting and returning <tt class="docutils literal"><span class="pre">str</span></tt> objects.</p>
</dd></dl>

<dl class="class">
<dt id="toto.clientsessioncache.AESCipher">
<em class="property">class </em><tt class="descclassname">toto.clientsessioncache.</tt><tt class="descname">AESCipher</tt><big>(</big><em>key</em>, <em>iv=None</em><big>)</big><a class="reference internal" href="_modules/toto/clientsessioncache.html#AESCipher"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#toto.clientsessioncache.AESCipher" title="Permalink to this definition">¶</a></dt>
<dd><p>A convenient cipher implementation for AES encryption and decryption.</p>
<p>Create a new <tt class="docutils literal"><span class="pre">AESCipher</span></tt> with the given <tt class="docutils literal"><span class="pre">key</span></tt> and <tt class="docutils literal"><span class="pre">iv</span></tt> that wraps
<tt class="docutils literal"><span class="pre">Crypto.AES</span></tt> but is reusable and thread safe. For convenience, both
the <tt class="docutils literal"><span class="pre">key</span></tt> and <tt class="docutils literal"><span class="pre">iv</span></tt> may be provided as one string, in which case the
last <tt class="docutils literal"><span class="pre">AES.block_size</span></tt> (16) bytes will be used for <tt class="docutils literal"><span class="pre">iv</span></tt>.</p>
</dd></dl>

<dl class="class">
<dt id="toto.redisconnection.RedisSessionCache">
<em class="property">class </em><tt class="descclassname">toto.redisconnection.</tt><tt class="descname">RedisSessionCache</tt><big>(</big><em>db</em><big>)</big><a class="reference internal" href="_modules/toto/redisconnection.html#RedisSessionCache"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#toto.redisconnection.RedisSessionCache" title="Permalink to this definition">¶</a></dt>
<dd><p>A <tt class="docutils literal"><span class="pre">TotoSessionCache</span></tt> implementation that uses Redis for session storage. Useful for improving the speed
of authenticated requests while still allowing account data to live in e.g. MySQL.</p>
<p><tt class="docutils literal"><span class="pre">db</span></tt> must be an instance of <tt class="docutils literal"><span class="pre">redis.StrictRedis</span></tt> initialized to the target database.</p>
</dd></dl>

</div>
<div class="section" id="the-totoaccount-class">
<h3>The TotoAccount class<a class="headerlink" href="#the-totoaccount-class" title="Permalink to this headline">¶</a></h3>
<dl class="class">
<dt id="toto.session.TotoAccount">
<em class="property">class </em><tt class="descclassname">toto.session.</tt><tt class="descname">TotoAccount</tt><big>(</big><em>session</em><big>)</big><a class="reference internal" href="_modules/toto/session.html#TotoAccount"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#toto.session.TotoAccount" title="Permalink to this definition">¶</a></dt>
<dd><p>Instances of TotoAccount provide dictionary-like access to user account properties. Unlike
sessions, account properties are loaded directly from distinct fields in the database so if
you&#8217;re not using a schemaless database you&#8217;ll need to make sure the fields (columns) exist
in advance.</p>
</dd></dl>

<dl class="method">
<dt id="toto.session.TotoAccount.load_property">
<tt class="descclassname">TotoAccount.</tt><tt class="descname">load_property</tt><big>(</big><em>*args</em><big>)</big><a class="reference internal" href="_modules/toto/session.html#TotoAccount.load_property"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#toto.session.TotoAccount.load_property" title="Permalink to this definition">¶</a></dt>
<dd><p>Load the properties passed to args. Properties will be dynamically loaded as they are accessed,
but if you know you&#8217;ll be referencing multiple properties, it can be faster to load them in bulk
by passing all the keys you want to load as arguments to this method first.</p>
</dd></dl>

<dl class="method">
<dt id="toto.session.TotoAccount.save">
<tt class="descclassname">TotoAccount.</tt><tt class="descname">save</tt><big>(</big><big>)</big><a class="reference internal" href="_modules/toto/session.html#TotoAccount.save"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#toto.session.TotoAccount.save" title="Permalink to this definition">¶</a></dt>
<dd><p>Save any modified keys to the user account stored in the database.</p>
</dd></dl>

</div>
</div>
</div>


      </div>
      <div class="bottomnav">
      
        <p>
        «&#160;&#160;<a href="web.html">The Toto web server</a>
        &#160;&#160;::&#160;&#160;
        <a class="uplink" href="index.html">Contents</a>
        &#160;&#160;::&#160;&#160;
        <a href="invocation.html">Method Decorators</a>&#160;&#160;»
        </p>

      </div>

    <div class="footer">
        &copy; Copyright 2015, Jeremy Olmsted-Thompson.
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 1.2.1.
    </div>
  </body>
</html>